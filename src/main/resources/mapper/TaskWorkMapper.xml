<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jutongji.bgk.dao.TaskWorkMapper">

    <sql id="Base_Column_List">
    id, homework_id, homework_user_id, name, type, owner_type, owner_id, state, user_id,
    user_name, deleted, video_path, created_by, created_at, submit_time
  </sql>


    <select id="selectByOwnerIdAndOwnerTypeAndDeleted" resultType="com.jutongji.bgk.model.TaskWork">
        select
        <include refid="Base_Column_List"/>
        from t_task_work
        where owner_id=#{ownerId} and owner_type=#{ownerType} and deleted = #{deleted}
    </select>

    <select id="countByOwnerTypeAndOwnerIdAndHomeworkIdAndDeletedAndStateIn" resultType="java.lang.Integer">
        select count(*) from t_task_work
        where owner_type=#{ownerType} and owner_id =#{ownerId} and homework_id = #{homeworkId} and deleted = #{deleted} and state in
        <foreach item="state" index="index" collection="stateList" open="(" separator="," close=")">
            #{state}
        </foreach>
    </select>

    <select id="countByOwnerTypeAndOwnerIdAndHomeworkIdAndDeletedAndState" resultType="java.lang.Integer">
        select count(*) from t_task_work
        where owner_type=#{ownerType} and owner_id =#{ownerId} and homework_id = #{homeworkId} and deleted = #{deleted} and state = #{state}
    </select>

    <select id="selectByUserIdAndDeleted" resultType="com.jutongji.bgk.model.TaskWork">
        select
        <include refid="Base_Column_List"/>
        from t_task_work
        where user_id=#{userId} and deleted =#{deleted}
    </select>





    <update id="updateById" parameterType="com.jutongji.bgk.model.TaskWork">
        update t_task_work
        <set>
            <if test="taskWork.state != null">
                state = #{taskWork.state,jdbcType=SMALLINT},
            </if>
            <if test="taskWork.videoPath != null">
                video_path = #{taskWork.videoPath,jdbcType=VARCHAR},
            </if>
            <if test="taskWork.homeworkUserId != null">
                homework_user_id = #{taskWork.homeworkUserId,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{taskWorkId,jdbcType=INTEGER}
    </update>

</mapper>